<!DOCTYPE html>
<html lang="en">
<head>
    <title>Dam the U.S.</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!--meta data for sharing links on Facebook-->
    <meta property="og:title" content="Dams in the U.S." />
    <meta property="og:url" content="http://rawgit.com/winkyt/USDam/master/index.html" />
    <meta property="og:description" content="A web map talks about dams in the U.S.." />
    <meta property="og:image" content="img/social.png" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.0.2/dist/leaflet.css" />

    <!--animation-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.5.2/animate.min.css">

    <!--facebook and info icons-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <!--use a better font for this web map-->
    <link href='http://fonts.googleapis.com/css?family=Lobster' rel='stylesheet' type='text/css'>


    <link rel="stylesheet" type="text/css" href="dist/storymap.css">
    <!--add favicon for the web page-->
    <link rel="shortcut icon" href="img/water.png" type="image/x-icon">

    <style>
        .end-background-img {
            background: url(img/Dam.jpg) no-repeat center center fixed;
        }
    </style>

    <!--add required libraries-->
    <script src="https://unpkg.com/leaflet@1.0.2/dist/leaflet.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://cdn.bootcss.com/chroma-js/1.3.3/chroma.min.js"></script>

    <!--story map plugin-->
    <script src="dist/storymap.js"></script>

    <!-- bing map -->
    <script src="https://cdn.polyfill.io/v2/polyfill.min.js?features=Promise"></script>
    <script src="http://gmaclennan.github.io/leaflet-bing-layer/leaflet-bing-layer.js"></script>

    <!-- mini globle map -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3/3.5.5/d3.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/topojson/1.6.19/topojson.min.js"></script>
    <script src="js/globeminimap.js"></script>
</head>
<body>
<div class="container-fluid">
    <div class="row">
        <div class="col-sm-6 col-md-4 main">

            <section data-scene="overview">
                <img class= "background-fullscreen-setting" src="img/USdam.jpg" alt="Reservior View"
                     style="width: 328px;height: 280px;">

                <div class= "background-fullscreen-setting text-responsive text-center" >
                    <h4>Dam the U.S.</h4>
                    <h3><small style="color: rgba(69, 168, 249, 0.7)">This Web Map Describes Dams in The U.S.</small></h3>
                </div>
            </section>

            <section data-scene="country">
                <h2>Why Dams?</h2>
                <p>After the Second World War, many countries aimed to improve and enhance their strength in the international community and accelerate their economic development.</p>
                <p>Dam provides multiple functions, including drinking water, flood control, irrigation,recreation, transpiration and hydropower.</p>
                <p>The International Commission on Large Dams states that a large dam either is at least 15 meters tall from its lowest foundation to its crest, or it stores more than 3 million cubic meters of water with a height between 5 meters to 15 meters.</p>
                <p>Among 140 countries, about 800,000 small dams and 50,000 large dams were built. There are an estimated 84,000 dams in the United States, impounding 600,000 mi (970,000 km) of river or about 17% of rivers in the nation.</p>
            </section>

            <section data-scene="environment">
                <h2>How do large dams affect rivers and environment? </h2>
                <p>The damming of great rivers is among the most dramatic, deliberate impacts that humans have on their natural environment. Nothing alters a river as totally as a dam.</p>
                <p>A dam is an attempt to bring a river under control, to regulate its seasonal pattern of floods and low flows. A dam traps sediments and nutrients, alters the river’s temperature and chemistry, and upsets the geological processes of erosion and deposition through which the river sculpts the surrounding land. Such changes can throw an entire watershed out of ecological balance.</p>
            </section>

            <section data-scene="hoover">
                <h2>Hoover Dam -- Created America’s largest reservoir</h2>
                <p>Formed by the damning of the Colorado River, Lake Mead, the nation’s largest reservoir, covers about 248 square miles and is capable of holding some 28.9 million acre-feet of water (an acre-foot is equivalent to about 325,000 gallons). The creation of Lake Mead (named for Elwood Mead, commissioner of the U.S. Bureau of Reclamation when the dam was being planned and built) flooded the community of St. Thomas, Nevada, and turned it into a ghost town. The last resident of the town, which was settled by Mormon pioneers in 1865, rowed away from his home in 1938. Today, the reservoir supplies water to farms, businesses and millions of people in Nevada, Arizona, California and Mexico. Lake Mead also is a popular site for boating, fishing and swimming; America’s first national recreation area was established there in 1964.</p>
                <p></p>
                <p></p>
                <img src="img/Hoover.jpg" class="img-responsive" alt="Hoover Dam image" >
            </section>

            <section data-scene="oroville">
                <h2>Oroville Dam- the tallest dam in the U.S.</h2>
                <p>Oroville Dam is an earthfill embankment dam on the Feather River east of the city of Oroville, California, in the Sierra Nevada foothills east of the Sacramento Valley. At 770 feet (235 m) high, it is the tallest dam in the U.S. and serves mainly for water supply, hydroelectricity generation and flood control. The dam impounds Lake Oroville, the second largest man-made lake in the state of California, capable of storing more than 3.5 million acre-feet.</p>
                <p></p>
                <p></p>

                <img src="img/OrovilleDam.png" class="img-responsive" alt="Oroville Dam" >
            </section>

            <section data-scene="bonneville">
                <h2>Bonneville Dam -- Oregon</h2>
                <p>Bonneville Lock and Dam consists of several run-of-the-river dam structures that together complete a span of the Columbia River between the U.S. states of Oregon and Washington at River Mile 146.1. The dam is located 40 miles (64 km) east of Portland, Oregon, in the Columbia River Gorge. The primary functions of Bonneville Lock and Dam are electrical power generation and river navigation. The dam was built and is managed by the United States Army Corps of Engineers.</p>
                <p>At the time of its construction in the 1930s it was the largest water impoundment project of its type in the nation, able to withstand flooding on an unprecendented scale. Electrical power generated at Bonneville is distributed by the Bonneville Power Administration.</p>
                <p>Bonneville Lock and Dam is named for Army Capt. Benjamin Bonneville, an early explorer credited with charting much of the Oregon Trail. The Bonneville Dam Historic District was designated a National Historic Landmark District in 1987.</p>
            </section>

            <section data-scene="snake">
                <h5>Why remove?</h5>
                <h2>Dam removal -- 4 lower Snake River dams, WA</h2>
                <p>1.The Northwest does not need the electricity generated by the dams.</p>
                <p>2.The four Lower Snake River dams are money losers for both tax- and bill-payers.</p>
                <p>3.We have proof that restoring rivers recovers salmon.</p>
                <p>4.We now have a clear understanding of the potentially catastrophic effects of warming on our remaining salmon.</p>
                <p>5.Our endangered Puget Sound orcas depend on Columbia Basin chinook salmon.</p>
            </section>

            <section data-scene="end">

                <video class="background-fullscreen-setting" playsinline autoplay muted loop>
                    <source src="assets/dam.mp4" type="video/mp4"></video>

            </section>

        </div>
        <!--map div-->
        <div id="map" class="col-sm-6 col-md-8 sidebar"></div>
    </div>
    <!--add a scrolling down arrow-->
    <div class="animated zoomIn infinite glyphicon glyphicon-menu-down arrow-down"></div>
    <!--add a navigation bar-->
    <div class="navbar text-center"></div>

    <!--add a info model -->
    <div id="loading">
        <i class="animated zoomIn infinite glyphicon glyphicon-globe"></i>
    </div>

    <dl>
        <dt>
            <!--facebook icon-->
            <a class="fa fa-facebook-square btn" href="https://facebook.com/sharer.php?u=http://rawgit.com/winkyt/USDam/master/index.html" target="_blank"></a>
        </dt>
        <dt>
            <!--facebook icon-->
            <a class="fa fa-git-square btn" href="https://github.com/winkyt/USDam" style="top:40px" target="_blank"></a>
        </dt>
        <dt>
            <!--info icon-->
            <i class="fa fa-file-text-o btn" style="top:60px" data-toggle="modal" data-target="#info-modal"></i>
        </dt>
    </dl>

    <!--the info page-->
    <div class="modal fade" id="info-modal" role="dialog">
        <div class="modal-dialog modal-md">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                    <h3 class="modal-title">About</h3>
                </div>
                <div class="modal-body">
                    <p>This is a web map about dams in the U.S. This is an assignement for GEOG572 lab. Web Mapping provided by Oregon State University. The story map library is derived from the storymap plugin for leaflet at <a>http://atlefren.github.io/storymap/</a>, and its functionality relies on both leaflet and Boostrap.</p>
                    <p><b>storymap.js</b> | Released Date: 02/20/2017 | Version: 2.1 | MIT License </p>
                    <p><b>Author: Yingqi Tang</b> | College of Earth, Ocean, Atmospheric Science | Oregon State University </p>
                    <p>The context about information of U.S dams  was collected from Wikipedia;the context about dam's environment impact was collected from world dam commission;
                        the context about Hoover dam, Oroville dam and Bonneville dam were collected from Wikipedia; the context about lower Snake River dam was collected from Snake River website</p>
                    <p>The <a src="https://www.youtube.com/watch?v=Nw4_gPWawgk">background video</a> on the end page was clipped from Youtube. </p>
                    <p>The favicon image was acquired from <a>https://image.flaticon.com/icons/png/512/183/183228.png</a></p>
                    <p>This story map uses geospatial data from Google Earth Engine, Microsoft Bing map, Open Street Maps and GRanD database.</p>
                </div>
            </div>
        </div>
    </div>

</div>

<!-- main javascript -->
<script type="text/javascript">

    /**
     * Created by yingqi on 4/30/2017.
     */
        // Create Legend Contents in html format
    var state_legend ='<i style="background: lightyellow; opacity: 0.5"></i><p><b>States</b></p>';


    $('html > head').append($("<style> .marker-icon { color: lightskyblue; font-size: 15px; text-shadow: 0 0 1px #000000;} </style>"));
    // $('html > head').append($("<style> .marker-icon { color: #0000ff; font-size: 15px; text-shadow:1px 1px 2px #ffffff, 0 0 25px rgba(0,0,255,0.75), 0 0 5px rgba(0,0,139,0.78);} </style>")); // glow effect: https://adventuresinmapping.com/2016/10/17/firefly-cartography/

    var dams = L.geoJson.ajax('assets/damsim.geojson', {
        pointToLayer: function (feature, latlng) {

            delay = 0;
            //delay =Math.floor(Math.random() * 400);

            return L.marker(latlng, {bounceOnAdd: true,  bounceOnAddOptions: {duration: 200, height: window.innerHeight, delay:delay}, icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon'})});
        },

    });

    var colors = chroma.scale('Accent').mode('lch').colors(10);
    for (i =1; i < 11; i++) {
        $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + colors[i] + "; font-size: 15px; text-shadow: 0 0 1px #FFFFFF;} </style>"));
    }


    var dams_color = L.geoJson.ajax('assets/damsim.geojson', {
        pointToLayer: function (feature, latlng) {
            if (feature.properties.MAIN_USE === "Fisheries") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-1'})});
            } else if (feature.properties.MAIN_USE === "Flood control") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-2'})});
            } else if (feature.properties.MAIN_USE === "Hydroelectricity") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-3'})});
            } else if (feature.properties.MAIN_USE === "Irrigation") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-4'})});
            } else if (feature.properties.MAIN_USE === "Navigation") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-5'})});
            } else if (feature.properties.MAIN_USE === "Other") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-6'})});
            } else if (feature.properties.MAIN_USE === "Recreation") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-7'})});
            } else if (feature.properties.MAIN_USE === "Unknown") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-8'})});
            } else if (feature.properties.MAIN_USE === "Water Supply") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-9'})});
            } else {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-10'})});
            }
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.DAM_NAME, {sticky: true, className: "feature-tooltip"});
        }
    });

    var dams_color_legend = '<p><b>Main Function</b></p>'+
        '<i class="glyphicon glyphicon-tint marker-icon-1"></i><p>Fisheries</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-2"></i><p>Flood control</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-3"></i><p>Hydroelectricity</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-4"></i><p>Irrigation</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-5"></i><p>Navigation</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-6"></i><p>Other</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-7"></i><p>Recreation</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-8"></i><p>Unknown</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-9"></i><p>Water Supply</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-10"></i><p>No data</p>';

    var quality = chroma.scale('Pastel1').mode('lch').colors(5);
    for (i =1; i < 6; i++) {
        $('html > head').append($("<style> .marker-icon-" + i.toString() + " { color: " + quality[i] + "; font-size: 15px; text-shadow: 0 0 1px #000000;} </style>"));
    }


    var dams_quality = L.geoJson.ajax('assets/qdam.geojson', {
        pointToLayer: function (feature, latlng) {
            if (feature.properties.QUALITY === "Good") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-1'})});
            } else if (feature.properties.QUALITY === "Fair") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-2'})});
            } else if (feature.properties.QUALITY === "Poor") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-3'})});
            } else if (feature.properties.QUALITY === "Unreliable") {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-4'})});
            } else {
                return L.marker(latlng, {icon: L.divIcon({className: 'glyphicon glyphicon-tint marker-icon-5'})});
            }
        },
        onEachFeature: function (feature, layer) {
            layer.bindTooltip(feature.properties.DAM_NAME, {sticky: true, className: "feature-tooltip"});
        }
    });

    var dams_quality_legend = '<p><b>Quality</b></p>'+
        '<i class="glyphicon glyphicon-tint marker-icon-1"></i><p>Goods</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-2"></i><p>Fair</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-3"></i><p>Poor</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-4"></i><p>Unreliable</p>' +
        '<i class="glyphicon glyphicon-tint marker-icon-5"></i><p>No data</p>' ;



    var layers = {
        'bing' : [L.tileLayer.bing('AuhiCJHlGzhg93IqUH_oCpl_-ZUrIE6SPftlyGYUvr9Amx5nzA-WqGcPquyFZl4L')],
        'state': [ L.geoJson.ajax('assets/bound.geojson',  {
            color: 'lightyellow',
            weight: 3,
            opacity: 0.5}), state_legend],
        'dams': [dams],
        'colors':[dams_color,dams_color_legend],
        'quality':[dams_quality,dams_quality_legend]

    };


    var scenes = {
        overview: {lat: 40.127259, lng: -98.796116, zoom: 4, position: 'fullpage', name: 'Cover Page'},
        country: {lat: 37.782654, lng: -120.163012, zoom: 4, name: 'Introduction', layers:['bing','state','colors']},
        environment: {lat: 37.782654, lng: -120.163012, zoom: 4, name: 'Impact of Environment', layers: ['bing','state','quality']},
        hoover: {lat: 36.0157356, lng: -114.7401217, zoom: 17, name: 'Hoover Dam', layers:['bing'] },
        oroville: {lat: 39.539437, lng: -121.496601, zoom: 15, name: 'Oroville Dam', layers:['bing']},
        bonneville: {lat: 45.646302, lng: -121.950859, zoom: 15, name: 'Bonneville Dam', layers: ['bing']},
        snake: {lat: 46.248835, lng: -118.886850, zoom: 15, name: 'Snake River Dams', layers: ['bing']},
        end: {lat: 40.127259, lng: -98.796116, zoom: 4, name: 'The End', position: 'fullpage'}
    };


    var Esri_WorldImagery = L.tileLayer('http://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}', {
        attribution: 'Tiles &copy; Esri &mdash; Source: Esri, i-cubed, USDA, USGS, AEX, GeoEye, Getmapping, Aerogrid, IGN, IGP, UPR-EGP, and the GIS User Community'
    });

    $('.main').storymap({
        scenes: scenes,
        layers: layers,
        legend: true, // if you do not want a legend feature, you can simply not define the createLegend function.
        scale: true,
        navbar: true,

        createMap: function () {
            // create a map in the "map" div, set the view to a given place and zoom
            var map = L.map('map', {zoomControl: false, scrollWheelZoom: false});

            // add an base map, which can be either OSM, mapbox, tilelayer, wmslayer or those designed by yourself.
            L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoiamFrb2J6aGFvIiwiYSI6ImNpcms2YWsyMzAwMmtmbG5icTFxZ3ZkdncifQ.P9MBej1xacybKcDN_jehvw', {
                maxZoom: 18,
                attribution: '<a href="http://ceoas.oregonstate.edu/profile/tang/" target="_blank">Yingqi Tang</a>',
                id: 'mapbox.light' // ,detectRetina: true
            }).addTo(map);


            // create a mini globe as the overview map control.
            var miniMap = new L.Control.GlobeMiniMap({
                marker:'red',
                position: 'bottomright'
            }).addTo(map);

            // hidden the credits, but show in the about page.
            $(".leaflet-control-attribution").css("display", "none");

            return map;
        }
    });
</script>
</body>
</html>